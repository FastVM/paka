

def huffman_gen_tree_addvar(vars, name) {
    i = 0
    while i < length(vars) {
        if vars[i] == name {
            vars[i + 1] = vars[i + 1] + 1
            return none
        }
        i = i + 2
    }
    vars ~= [name, 1]
}

def huffman_gen_tree_setvar(vars, name, val) {
    i = 0
    while i < length(vars) {
        if vars[i] == name {
            if vars[i + 1] != none {
                vars[i + 1] = val
                return none
            }
        }
        i = i + 2
    }
    vars ~= [name, val]
}

def huffman_gen_tree_getvar(vars, name) {
    i = 0
    while i < length(vars) {
        if vars[i] == name {
            res = vars[i + 1]
            if res != none {
                return res
            }
        }
        i = i + 2
    }
    return none
}

def huffman_gen_tree_rmvar(vars, name) {
    huffman_gen_tree_setvar(vars, name, none)
}

def huffman_gen_tree_smallvar(vars) {
    ret = none
    best = 0
    i = 0
    while i < length(vars) {
        val = vars[i]
        cur = vars[i + 1]
        if cur != none {
            if best == 0 {
                best = cur
                ret = vars[i]
            }
            if cur < best {
                best = cur
                ret = vars[i]
            }
        }
        i = i + 2
    }
    return ret
}

def huffman_gen_tree_lenvar(vars) {
    ret = 0
    i = 0
    while i < length(vars) {
        if vars[i + 1] != none {
            ret = ret + 1
        }
        i = i + 2
    }
    return ret
}

def huffman_gen_tree(thing) {
    counts = []
    i = 0
    while i < length(thing) {
        huffman_gen_tree_addvar(counts, thing[i])
        i = i + 1
    }
    while huffman_gen_tree_lenvar(counts) >= 2 {
        s1 = huffman_gen_tree_smallvar(counts)
        n1 = huffman_gen_tree_getvar(counts, s1)
        huffman_gen_tree_rmvar(counts, s1)
        s2 = huffman_gen_tree_smallvar(counts)
        n2 = huffman_gen_tree_getvar(counts, s2)
        huffman_gen_tree_rmvar(counts, s2)
        sr = [s1, s2]
        nr = n1 + n2
        huffman_gen_tree_setvar(counts, sr, nr)
    }
    return huffman_gen_tree_smallvar(counts)
}
